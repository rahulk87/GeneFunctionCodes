suppressPackageStartupMessages(library("Biobase"))
suppressPackageStartupMessages(library("blme"))
suppressPackageStartupMessages(library("doMC"))
suppressPackageStartupMessages(library("genefilter"))
suppressPackageStartupMessages(library("ggplot2"))
suppressPackageStartupMessages(library("locfit"))
suppressPackageStartupMessages(library("MASS"))
suppressPackageStartupMessages(library("plyr"))
suppressPackageStartupMessages(library("preprocessCore"))
suppressPackageStartupMessages(library("reshape"))
source("../../../../../mem_code/data_format_lib.R")
source("../../../../../mem_code/model_lib.R")
source("../../../../../mem_code/simem_lib.R")
load("../../../../../data/breast_screens_with_weights.eset")
hp = read.delim("../../../../../data/hairpin_annotations.txt", header=T, as.is=T, check.names=F)
hpWeights = hp[,c("trcn_id", "gene_id", "weight")]

i=1
list=read.csv("list1",sep="\t",header=FALSE, stringsAsFactors=FALSE)
        for (genes in list$V1)
        {
	i=i+1
        x <- genes
        y <- tolower(x)
        print (x)
	#### creating mutation file for each gene ####
	file<-read.table("../combined_exome_cnv_func_muts_131216_gt3.txt",sep="\t",header=TRUE)
	cells <- as.data.frame(file[,1])
	gene_mut<-cbind(cells,file[,i])
	names(gene_mut) <- c("cell_line", "Gene")
	write.table(gene_mut,file="gene_mut.txt",sep="\t",row.names=F,quote = FALSE)
	##############################################
	subtypes = read.delim("gene_mut.txt", header=T, as.is=T, check.names=F)
	status = subtypes[,c("cell_line", "Gene")]
	status$gene = ifelse(status$Gene == "1", "high", "low")
	genesOfInterest = c(10006,25,27,57007,2181,23305,90,4299,3899,27125,10142,207,208,217,139285,324,9582,367,23092,23365,8289,57492,79058,171023,466,471,472,476,492,545,546,8312,8313,567,8314,8915,53335,64919,596,602,604,605,607,54880,63035,613,330,657,673,672,675,8019,23476,83990,694,695,701,80304,776,811,23261,124583,84433,833,57082,841,863,867,868,23624,8030,57820,595,894,896,898,29126,972,973,974,1009,51755,1019,1021,1027,1029,1031,1045,1050,84902,79145,1108,11200,26511,23152,4261,6249,10978,1213,8218,7555,4849,1277,1280,1345,1385,90993,64764,1387,64109,23373,64784,1441,10664,1499,1523,7852,1540,1616,1639,1649,4921,1654,1655,1656,7913,23405,400242,3337,1785,1788,29102,1879,1956,3646,2000,2005,8178,27436,2033,2060,2064,2065,2066,23085,2068,2071,2072,2073,2099,55500,2115,2118,2119,2120,2130,2131,2132,2146,7430,9715,2175,2176,2177,2178,2188,2189,79633,80204,2213,83417,54738,2260,2263,2261,2264,2271,2272,81608,201163,2313,2322,2324,23048,3169,668,2308,2309,4303,27086,10272,8880,2521,8522,2624,2625,8833,2767,2778,9950,57120,2719,10243,2903,3020,3021,9709,23462,3091,3092,8358,8294,3105,3131,3159,8091,283651,6927,3207,3209,3227,3229,3237,3239,3265,3326,3417,3418,3551,10320,3558,50615,3572,3575,3662,3702,3716,3717,3718,221895,3725,7994,23522,5927,7403,9817,57670,57698,3799,3815,9314,1316,3817,4297,58508,8085,3845,3927,3932,3936,51176,3977,4000,4004,4005,4026,121227,53353,26065,4066,4094,10892,84441,5604,5605,6416,4214,9175,5594,4193,4194,2122,9968,4221,4233,4286,57591,4291,4292,4298,8028,10962,4300,4301,4302,3110,4352,4436,2956,124540,4478,4515,2475,4582,4602,4609,4610,4613,4615,4629,4627,4644,4654,4665,4666,4683,51517,8648,10499,8031,9611,9612,10397,4763,4771,4773,4780,4781,4794,51199,7080,4841,4851,4869,8013,4893,3084,64324,22978,4914,4916,4926,8021,4928,256646,10215,4958,286530,5049,142,5077,5079,5081,7849,55193,5108,9159,80380,9659,5155,5156,5159,5187,84295,8929,8301,5290,5295,5292,5324,5335,5378,5395,5426,25913,8496,8493,5518,5537,5546,639,63976,80243,5551,5566,5573,5396,11168,5727,5728,5753,5781,5783,5787,5788,5796,11122,9444,9135,5879,5885,5890,5900,5903,5910,5914,5925,8241,64783,9401,5966,5979,387,399,116028,57674,54894,6098,6134,6146,6125,6184,340419,84870,861,862,51119,6385,6389,54949,6390,6391,6392,5413,23157,10801,26040,29072,23451,6421,10019,6455,10568,85414,4087,4088,4089,6597,6598,6602,6605,6608,27044,8651,23013,8405,9901,6427,6428,6760,26039,6756,6757,6759,10735,6774,6777,6778,6491,6794,6801,51684,6850,8148,6886,6887,79718,6926,6917,6938,6929,6934,8115,27004,80312,54790,7942,7037,7048,9967,3195,7113,7128,8764,608,7150,7157,7170,7171,7175,84231,8805,5987,51592,9321,8295,7248,7249,7253,150465,7307,51366,9098,9101,7428,143187,7454,7468,54904,11197,7486,7490,51352,25937,7507,7508,7514,7531,7704,55596,463,171017,25925,8233,238,405,641,865,79577,999,11064,1643,1974,2006,2034,2078,355,2195,55294,11116,2623,2776,3181,3205,3320,3762,8242,2531,3895,9935,4149,4330,4595,4791,4853,5087,5371,5450,5460,5894,6418,6657,23512,7030,10342,30012,8626,55422)
	results = simem(screens = breast_screens, geneIds = genesOfInterest, covariate = "gene",reagentWeights = hpWeights, annotationsPerCellLine = status, inverseVarianceWeights = TRUE, signalProbWeights = TRUE,analyzeReagents = TRUE,covariateFactorOrder = c("low", "high"), parallelNodes = 8)
	result <- results$gene
	write.csv(result,file=paste("result_",y,sep=""))
	file.remove("gene_mut.txt")
	}
